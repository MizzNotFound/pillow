<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DreamPillow - G·ªëi Th√¥ng Minh</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;0,700;1,400&family=Dancing+Script:wght@700&display=swap"
        rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <style>
        :root {
            --bg-primary: #1a1512;
            --bg-secondary: #2a2118;
            --bg-card: #3a2f24;
            --accent: #c4a77d;
            --accent-light: #e8d5b7;
            --text-primary: #f5efe6;
            --text-secondary: #a89a8a;
            --shadow: rgba(0, 0, 0, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        h1,
        h2,
        h3,
        .logo,
        .section-title {
            font-family: 'Dancing Script', cursive;
            font-weight: 700;
        }

        /* Specific overrides if needed to keep some subtitles normal */
        .subtitle,
        p,
        a,
        button,
        .intro-text,
        .guide-step p {
            font-family: 'Crimson Text', serif;
            font-size: 1.1rem;
        }

        body {
            font-family: 'Crimson Text', serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Floating particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--accent);
            border-radius: 50%;
            opacity: 0.3;
            animation: float 15s infinite ease-in-out;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }

            10% {
                opacity: 0.3;
            }

            90% {
                opacity: 0.3;
            }

            100% {
                transform: translateY(-100vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* Header */
        header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 20px 50px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            background: linear-gradient(to bottom, var(--bg-primary), transparent);
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--accent);
            letter-spacing: 2px;
        }

        .logo span {
            color: var(--text-primary);
        }

        nav a {
            color: var(--text-secondary);
            text-decoration: none;
            margin-left: 30px;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        nav a:hover {
            color: var(--accent);
        }

        /* Hero Section */
        .hero {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 100px 50px;
            position: relative;
        }

        .hero-content {
            max-width: 600px;
            z-index: 10;
            animation: fadeInUp 1s ease-out;
        }





        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .hero-content h1 {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 20px;
            line-height: 1.2;
        }

        .hero-content h1 span {
            color: var(--accent);
        }

        .hero-content p {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 30px;
            line-height: 1.8;
        }

        .cta-button {
            display: inline-block;
            padding: 15px 40px;
            background: linear-gradient(135deg, var(--accent), #8b7355);
            color: var(--bg-primary);
            text-decoration: none;
            font-weight: 600;
            border-radius: 50px;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(196, 167, 125, 0.3);
        }

        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(196, 167, 125, 0.4);
        }

        /* 3D Pillow Section */
        .pillow-section {
            padding: 80px 50px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(180deg, transparent, var(--bg-secondary), transparent);
        }

        .pillow-section h2 {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--accent);
        }

        .pillow-section .subtitle {
            color: var(--text-secondary);
            margin-bottom: 30px;
            font-size: 1rem;
        }

        .pillow-3d-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            height: 450px;
            border-radius: 20px;
            overflow: hidden;
            background: radial-gradient(ellipse at center, #2a2118 0%, #1a1512 100%);
        }

        #pillow-canvas {
            width: 100%;
            height: 100%;
            cursor: grab;
        }

        #pillow-canvas:active {
            cursor: grabbing;
        }

        /* 360 Controls */
        .controls-360 {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .control-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            background: var(--bg-card);
            border: 2px solid var(--accent);
            border-radius: 50%;
            color: var(--accent);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: var(--accent);
            color: var(--bg-primary);
            transform: scale(1.1);
        }

        .control-btn.active {
            background: var(--accent);
            color: var(--bg-primary);
        }

        .rotate-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: var(--bg-card);
            border-radius: 25px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .rotate-badge svg {
            width: 20px;
            height: 20px;
            animation: spin 3s linear infinite;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        /* Feature hotspots info */
        .feature-info {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .feature-tag {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 18px;
            background: var(--bg-card);
            border-radius: 25px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .feature-tag:hover,
        .feature-tag.active {
            border-color: var(--accent);
            background: rgba(196, 167, 125, 0.2);
        }

        .feature-tag .icon {
            font-size: 1.2rem;
        }

        /* Features Section */
        .features {
            padding: 100px 50px;
        }

        .section-title {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 60px;
            opacity: 0;
            animation: fadeIn 1s ease-out forwards;
        }

        .section-title span {
            color: var(--accent);
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .feature-card {
            background: var(--bg-card);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            transition: all 0.4s ease;
            opacity: 0;
            transform: translateY(30px);
            animation: cardAppear 0.8s ease-out forwards;
            position: relative;
            overflow: hidden;
        }

        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent), var(--accent-light));
            transform: scaleX(0);
            transition: transform 0.4s ease;
        }

        .feature-card:hover::before {
            transform: scaleX(1);
        }

        .feature-card:nth-child(1) {
            animation-delay: 0.1s;
        }

        .feature-card:nth-child(2) {
            animation-delay: 0.2s;
        }

        .feature-card:nth-child(3) {
            animation-delay: 0.3s;
        }

        .feature-card:nth-child(4) {
            animation-delay: 0.4s;
        }

        @keyframes cardAppear {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px var(--shadow);
        }

        .feature-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            display: block;
        }

        .feature-card h3 {
            font-size: 1.4rem;
            margin-bottom: 15px;
            color: var(--accent);
        }

        .feature-card p {
            color: var(--text-secondary);
            line-height: 1.7;
        }

        /* Benefits Section */
        .benefits {
            padding: 100px 50px;
            background: var(--bg-secondary);
        }

        .benefits-content {
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .benefit-list {
            list-style: none;
            width: 100%;
        }

        .benefit-list li {
            padding: 20px 30px;
            border-bottom: 1px solid rgba(196, 167, 125, 0.2);
            display: flex;
            align-items: center;
            gap: 15px;
            opacity: 0;
            animation: slideIn 0.6s ease-out forwards;
            font-size: 1.1rem;
        }

        .benefit-list li:nth-child(1) {
            animation-delay: 0.1s;
        }

        .benefit-list li:nth-child(2) {
            animation-delay: 0.2s;
        }

        .benefit-list li:nth-child(3) {
            animation-delay: 0.3s;
        }

        .benefit-list li:nth-child(4) {
            animation-delay: 0.4s;
        }

        .benefit-list li:nth-child(5) {
            animation-delay: 0.5s;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .benefit-list li::before {
            content: '‚ú¶';
            color: var(--accent);
            font-size: 1.4rem;
        }

        /* Music Visualizer */
        .music-visualizer {
            display: flex;
            align-items: flex-end;
            gap: 4px;
            height: 40px;
            justify-content: center;
            margin: 20px 0;
        }

        .bar {
            width: 6px;
            background: var(--accent);
            border-radius: 3px;
            animation: musicBars 1s ease-in-out infinite;
        }

        .bar:nth-child(1) {
            animation-delay: 0s;
            height: 20px;
        }

        .bar:nth-child(2) {
            animation-delay: 0.1s;
            height: 35px;
        }

        .bar:nth-child(3) {
            animation-delay: 0.2s;
            height: 25px;
        }

        .bar:nth-child(4) {
            animation-delay: 0.3s;
            height: 40px;
        }

        .bar:nth-child(5) {
            animation-delay: 0.4s;
            height: 30px;
        }

        .bar:nth-child(6) {
            animation-delay: 0.5s;
            height: 20px;
        }

        .bar:nth-child(7) {
            animation-delay: 0.6s;
            height: 35px;
        }

        @keyframes musicBars {

            0%,
            100% {
                transform: scaleY(1);
            }

            50% {
                transform: scaleY(0.5);
            }
        }

        /* Footer */
        footer {
            padding: 50px;
            text-align: center;
            background: var(--bg-primary);
            border-top: 1px solid rgba(196, 167, 125, 0.1);
        }

        footer p {
            color: var(--text-secondary);
        }

        /* Responsive */
        @media (max-width: 768px) {
            header {
                padding: 15px 20px;
                flex-direction: column;
                gap: 15px;
                background: var(--bg-primary);
                /* Solid background to prevent overlap */
                box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            }

            /* Fix anchor scrolling position */
            section {
                scroll-margin-top: 120px;
            }

            nav a {
                margin: 0 15px;
            }

            .hero {
                padding: 120px 20px 60px;
            }

            .hero-content h1 {
                font-size: 2.2rem;
            }

            .pillow-section {
                padding: 50px 20px;
            }

            .pillow-3d-container {
                height: 350px;
            }

            .section-title {
                font-size: 1.8rem;
            }
        }

        /* Scroll animations */
        .scroll-animate {
            opacity: 0;
            transform: translateY(50px);
            transition: all 0.8s ease-out;
        }

        .scroll-animate.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Control Panel Styles */
        .control-panel {
            background: rgba(58, 47, 36, 0.95);
            /* Higher opacity */
            backdrop-filter: blur(12px);
            border: 1px solid rgba(196, 167, 125, 0.3);
            border-radius: 20px;
            padding: 15px 30px;
            display: flex;
            gap: 30px;
            margin-top: 30px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
            z-index: 10;
            flex-wrap: wrap;
            justify-content: center;
        }

        .control-btn-group {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .control-sep {
            width: 1px;
            height: 50px;
            background: rgba(196, 167, 125, 0.2);
            display: none;
        }

        @media (min-width: 768px) {
            .control-sep {
                display: block;
            }
        }

        .feature-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            background: transparent;
            border: 2px solid transparent;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 12px;
            border-radius: 16px;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            width: 85px;
            height: 90px;
        }

        .feature-btn:hover {
            background: rgba(196, 167, 125, 0.1);
            color: var(--text-primary);
            transform: translateY(-3px);
        }

        .feature-btn.active {
            background: rgba(196, 167, 125, 0.15);
            border-color: var(--accent);
            color: var(--accent);
            box-shadow: 0 0 20px rgba(196, 167, 125, 0.2);
        }

        .feature-icon-lg {
            font-size: 2rem;
            margin-bottom: 2px;
            transition: transform 0.3s ease;
        }

        /* Active animations */
        .feature-btn.active.music-btn .feature-icon-lg {
            animation: noteFloat 2s infinite ease-in-out;
        }

        .feature-btn.active.alarm-btn .feature-icon-lg {
            animation: bellShake 0.5s infinite;
        }

        .feature-btn.active.massage-btn .feature-icon-lg {
            animation: massagePulse 0.8s infinite;
        }

        .feature-btn.active.scent-btn .feature-icon-lg {
            animation: scentRise 3s infinite;
        }

        .control-btn-sm {
            width: 45px;
            height: 45px;
            background: var(--bg-card);
            border: 1px solid var(--accent);
            border-radius: 50%;
            color: var(--accent);
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-btn-sm:hover {
            background: var(--accent);
            color: var(--bg-primary);
            transform: scale(1.1);
        }

        .control-btn-sm.active {
            background: var(--accent);
            color: var(--bg-primary);
            box-shadow: 0 0 15px var(--accent);
        }

        /* Pillow Overlay Message */
        .pillow-overlay {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.6);
            padding: 8px 16px;
            border-radius: 20px;
            color: #fff;
            font-size: 0.9rem;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }

        @keyframes noteFloat {
            0% {
                transform: translateY(0) rotate(0);
            }

            50% {
                transform: translateY(-8px) rotate(15deg);
            }

            100% {
                transform: translateY(0) rotate(0);
            }
        }

        @keyframes bellShake {
            0% {
                transform: rotate(0);
            }

            25% {
                transform: rotate(-20deg);
            }

            75% {
                transform: rotate(20deg);
            }

            100% {
                transform: rotate(0);
            }
        }

        @keyframes massagePulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.15);
            }

            100% {
                transform: scale(1);
            }
        }

        @keyframes scentRise {
            0% {
                transform: translateY(0);
                opacity: 0.7;
            }

            100% {
                transform: translateY(-15px);
                opacity: 0;
            }
        }

        /* Temperature Control Styles */
        .temp-control {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text-secondary);
        }

        .temp-control label {
            font-size: 0.9rem;
        }

        .temp-control input[type="range"] {
            width: 100px;
            accent-color: var(--accent);
            cursor: pointer;
        }

        .temp-control #temp-value {
            font-weight: bold;
            color: var(--accent);
            min-width: 50px;
        }

        /* Custom Icons */
        .custom-icon {
            width: 28px;
            height: 28px;
            object-fit: contain;
            filter: drop-shadow(0 0 4px rgba(255, 255, 255, 0.4));
            margin-bottom: 4px;
        }

        .custom-icon-sm {
            width: 20px;
            height: 20px;
            vertical-align: middle;
            margin-right: 5px;
            object-fit: contain;
        }

        .custom-icon-feature {
            width: 56px;
            height: 56px;
            object-fit: contain;
            margin-bottom: 15px;
            filter: drop-shadow(0 0 8px rgba(212, 175, 55, 0.3));
        }

        .feature-btn img {
            pointer-events: none;
        }

        /* Journey Carousel Styles */
        .journey-carousel {
            position: absolute;
            top: 50%;
            right: 5%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            z-index: 10;
            max-width: 300px;
        }

        .carousel-slides {
            position: relative;
            width: 100%;
            overflow: hidden;
            border-radius: 16px;
        }

        .carousel-slide {
            display: none;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(12px);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            transition: all 0.4s ease;
        }

        .carousel-slide.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .carousel-slide img {
            width: 100%;
            max-height: 200px;
            object-fit: contain;
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .carousel-slide h4 {
            margin: 0;
            font-size: 1.2rem;
            color: var(--accent);
        }

        .carousel-slide p {
            margin: 5px 0 0;
            font-size: 0.9rem;
            color: #ccc;
        }

        .carousel-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            padding: 10px 14px;
            font-size: 1.2rem;
            cursor: pointer;
            border-radius: 50%;
            z-index: 11;
            transition: background 0.3s;
        }

        .carousel-btn:hover {
            background: var(--accent);
        }

        .carousel-btn.prev {
            left: -15px;
        }

        .carousel-btn.next {
            right: -15px;
        }

        .carousel-dots {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .carousel-dots .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: background 0.3s;
        }

        .carousel-dots .dot.active,
        .carousel-dots .dot:hover {
            background: var(--accent);
        }

        /* Journey Section Styles */
        .journey-section {
            padding: 80px 5%;
            background: linear-gradient(180deg, var(--bg-primary) 0%, #1a1510 100%);
        }

        .journey-carousel-large {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            max-width: 900px;
            margin: 40px auto;
        }

        .carousel-content {
            flex: 1;
            max-width: 700px;
        }

        .carousel-slide-lg {
            display: none;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            border: 1px solid rgba(196, 167, 125, 0.2);
        }

        .carousel-slide-lg.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .carousel-slide-lg img {
            width: 100%;
            max-height: 350px;
            object-fit: contain;
            border-radius: 12px;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.9);
        }

        .carousel-slide-lg .slide-info h3 {
            margin: 0;
            font-size: 1.5rem;
            color: var(--accent);
        }

        .carousel-slide-lg .slide-info p {
            margin: 10px 0 0;
            font-size: 1rem;
            color: #ddd;
            line-height: 1.6;
        }

        .carousel-btn-lg {
            background: var(--accent);
            color: var(--bg-primary);
            border: none;
            width: 50px;
            height: 50px;
            font-size: 1.5rem;
            cursor: pointer;
            border-radius: 50%;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .carousel-btn-lg:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px var(--accent);
        }

        .journey-section .section-title,
        .journey-section .subtitle {
            text-align: center;
        }

        .journey-section .subtitle {
            color: #aaa;
            margin-bottom: 40px;
            font-size: 1.1rem;
        }

        .carousel-dots-lg {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .dot-lg {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(196, 167, 125, 0.3);
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .dot-lg.active,
        .dot-lg:hover {
            background: var(--accent);
            color: var(--bg-primary);
            border-color: var(--accent);
        }

        /* Scroll Animations */
        .scroll-animate {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .scroll-animate.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2.5rem;
            }

            .hero p {
                font-size: 1rem;
                padding: 0 20px;
            }

            /* 3D Container Adjustments */
            .pillow-section {
                height: 60vh;
                margin-top: 60px;
            }

            .control-panel {
                top: auto;
                bottom: 20px;
                right: 50%;
                transform: translateX(50%);
                width: 90%;
                flex-direction: column;
                gap: 15px;
            }

            .control-btn-group {
                gap: 10px;
            }

            .feature-btn span:last-child {
                display: none;
            }

            /* Hide text on small screens */
            .feature-icon-lg {
                font-size: 1.5rem;
                margin: 0;
            }

            .temp-control {
                flex-direction: column;
                gap: 5px;
            }

            /* Journey Section Mobile */
            .journey-carousel-large {
                flex-direction: column;
                position: relative;
            }

            .carousel-content {
                width: 100%;
            }

            .carousel-btn-lg {
                position: absolute;
                top: 30%;
                /* Align with image */
                z-index: 5;
            }

            .carousel-btn-lg.prev {
                left: -10px;
            }

            .carousel-btn-lg.next {
                right: -10px;
            }

            .carousel-slide-lg {
                padding: 20px;
            }

            .carousel-slide-lg img {
                max-height: 200px;
            }

            .features-grid {
                grid-template-columns: 1fr;
            }

            /* Mobile 3D Section Fix */
            .pillow-section {
                height: auto;
                padding-bottom: 100px;
            }

            .pillow-3d-container {
                height: 550px;
                width: 100%;
                margin-bottom: 20px;
                flex-shrink: 0;
            }

            #pillow-canvas {
                width: 100% !important;
                height: 100% !important;
            }

            .control-panel {
                position: relative;
                width: 95%;
                margin: 10px auto;
                bottom: auto;
                flex-shrink: 0;
                padding: 10px 15px;
                gap: 15px;
            }

            .control-btn-group {
                flex-wrap: wrap;
                justify-content: center;
                gap: 10px;
            }

            .feature-btn {
                width: 70px;
                height: 75px;
                padding: 8px;
            }

            .feature-btn span:last-child {
                font-size: 0.7rem;
            }

            .control-btn-sm {
                width: 38px;
                height: 38px;
                font-size: 1rem;
            }

            .temp-control {
                flex-wrap: wrap;
                justify-content: center;
                gap: 8px;
            }

            .temp-control input[type="range"] {
                width: 80px;
            }
        }

        /* Materials Section */
        .materials-section {
            padding: 80px 5%;
            background: linear-gradient(180deg, #1a1510 0%, var(--bg-primary) 100%);
            text-align: center;
        }

        .materials-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
            margin-top: 50px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        .material-card {
            background: rgba(255, 255, 255, 0.03);
            padding: 40px 30px;
            border-radius: 20px;
            border: 1px solid rgba(196, 167, 125, 0.1);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .material-card:hover {
            transform: translateY(-10px);
            border-color: var(--accent);
            background: rgba(255, 255, 255, 0.05);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }

        .material-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--accent);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.4s ease;
        }

        .material-card:hover::before {
            transform: scaleX(1);
        }

        .material-icon {
            font-size: 3.5rem;
            margin-bottom: 25px;
            display: inline-block;
            background: linear-gradient(135deg, #fff 0%, var(--accent) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .material-card h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: var(--text-primary);
        }

        .material-card p {
            color: var(--text-secondary);
            font-size: 1rem;
            line-height: 1.6;
        }

        /* Product Intro Section */
        .intro-section {
            padding: 100px 5%;
            text-align: center;
            max-width: 1000px;
            margin: 0 auto;
        }

        .intro-text {
            font-size: 1.2rem;
            line-height: 1.8;
            color: var(--text-secondary);
            margin-bottom: 30px;
        }

        .intro-highlight {
            color: var(--accent);
            font-weight: 700;
        }

        /* User Guide Section */
        .guide-section {
            padding: 80px 5%;
            background: rgba(255, 255, 255, 0.02);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            margin-top: 50px;
        }

        .guide-steps {
            display: flex;
            justify-content: center;
            gap: 50px;
            flex-wrap: wrap;
            margin-top: 50px;
        }

        .guide-step {
            flex: 1;
            min-width: 250px;
            max-width: 350px;
            text-align: center;
            position: relative;
        }

        .step-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            object-fit: contain;
            filter: drop-shadow(0 0 10px rgba(196, 167, 125, 0.4));
            transition: transform 0.3s ease;
        }

        .guide-step:hover .step-icon {
            transform: scale(1.1);
            filter: drop-shadow(0 0 20px rgba(196, 167, 125, 0.8));
        }

        .guide-step h3 {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: var(--text-primary);
        }

        .guide-step p {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            .guide-steps {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>

<body>
    <!-- Floating Particles -->
    <div class="particles" id="particles"></div>

    <!-- Header -->
    <header>
        <div class="logo">Dream<span>Pillow</span></div>
        <nav>
            <a href="#intro">Gi·ªõi Thi·ªáu</a>
            <a href="#pillow">Xem 3D</a>
            <a href="#features">T√≠nh nƒÉng</a>
            <a href="#guide">H∆∞·ªõng D·∫´n</a>
        </nav>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
            <h1 class="scroll-animate visible">Gi·∫•c Ng·ªß <span>Ho√†n H·∫£o</span> B·∫Øt ƒê·∫ßu T·ª´ ƒê√¢y</h1>
            <p class="scroll-animate visible">G·ªëi th√¥ng minh DreamPillow v·ªõi c√¥ng ngh·ªá ti√™n ti·∫øn - b√°o th·ª©c nh·∫π nh√†ng,
                massage th∆∞ gi√£n, nh·∫°c lofi du d∆∞∆°ng v√† h∆∞∆°ng th∆°m d·ªÖ ch·ªãu. Mang ƒë·∫øn gi·∫•c ng·ªß s√¢u v√† th·ª©c d·∫≠y tr√†n ƒë·∫ßy
                nƒÉng l∆∞·ª£ng.</p>
            <a href="#pillow" class="cta-button scroll-animate visible">Kh√°m Ph√° 3D</a>
        </div>
    </section>

    <!-- Product Introduction Section -->
    <section class="intro-section" id="intro">
        <h2 class="section-title scroll-animate">V·ªÅ <span>DreamPillow</span></h2>
        <p class="intro-text scroll-animate">
            <span class="intro-highlight">DreamPillow</span> l√† chi·∫øc g·ªëi th√¥ng minh ƒë·∫ßu ti√™n t·∫°i Vi·ªát Nam t√≠ch h·ª£p
            tr√≠ tu·ªá nh√¢n t·∫°o ƒë·ªÉ chƒÉm s√≥c gi·∫•c ng·ªß c·ªßa b·∫°n. ƒê∆∞·ª£c nghi√™n c·ª©u v√† ph√°t tri·ªÉn b·ªüi c√°c chuy√™n gia h√†ng ƒë·∫ßu,
            ch√∫ng t√¥i mang ƒë·∫øn m·ªôt gi·∫£i ph√°p to√†n di·ªán gi√∫p b·∫°n gi·∫£i t·ªèa cƒÉng th·∫≥ng sau ng√†y l√†m vi·ªác m·ªát m·ªèi.
        </p>
        <p class="intro-text scroll-animate">
            Kh√¥ng ch·ªâ l√† m·ªôt chi·∫øc g·ªëi, DreamPillow l√† ng∆∞·ªùi b·∫°n ƒë·ªìng h√†nh, hi·ªÉu r√µ chu k·ª≥ gi·∫•c ng·ªß c·ªßa b·∫°n v√†
            t·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh nhi·ªát ƒë·ªô, √¢m thanh v√† ch·∫ø ƒë·ªô massage ƒë·ªÉ mang l·∫°i tr·∫£i nghi·ªám ngh·ªâ ng∆°i tuy·ªát v·ªùi nh·∫•t.
        </p>
    </section>

    <!-- 3D Pillow Section -->
    <section class="pillow-section" id="pillow">
        <h2>üõèÔ∏è Tr·∫£i Nghi·ªám Th·ª±c T·∫ø</h2>
        <p class="subtitle">Ch·∫°m v√†o c√°c bi·ªÉu t∆∞·ª£ng ƒë·ªÉ k√≠ch ho·∫°t t√≠nh nƒÉng th√¥ng minh</p>

        <div class="pillow-3d-container">
            <canvas id="pillow-canvas"></canvas>
            <div id="pillow-overlay-msg" class="pillow-overlay"></div>
        </div>

        <!-- Interactive Control Panel -->
        <div class="control-panel">
            <!-- Features -->
            <div class="control-btn-group">
                <button class="feature-btn music-btn" id="btn-music" onclick="activateFeature('music')">
                    <img src="images/icon_tech_music.png" alt="Music" class="custom-icon">
                    <span>Music</span>
                </button>
                <button class="feature-btn alarm-btn" id="btn-alarm" onclick="activateFeature('alarm')">
                    <img src="images/icon_tech_alarm.png" alt="Alarm" class="custom-icon">
                    <span>Alarm</span>
                </button>
                <button class="feature-btn massage-btn" id="btn-massage" onclick="activateFeature('massage')">
                    <img src="images/icon_tech_massage.png" alt="Massage" class="custom-icon">
                    <span>Massage</span>
                </button>
                <button class="feature-btn scent-btn" id="btn-scent" onclick="activateFeature('scent')">
                    <img src="images/icon_tech_scent.png" alt="Scent" class="custom-icon">
                    <span>Scent</span>
                </button>
            </div>

            <div class="control-sep"></div>

            <!-- Rotation Controls -->
            <div class="control-btn-group">
                <button class="control-btn-sm" id="rotate-left" title="Xoay Tr√°i">‚Ü∫</button>
                <button class="control-btn-sm active" id="auto-rotate" title="T·ª± ƒê·ªông Xoay">‚ú®</button>
                <button class="control-btn-sm" id="rotate-right" title="Xoay Ph·∫£i">‚Üª</button>
            </div>

            <div class="control-sep"></div>

            <!-- Temperature Control -->
            <div class="temp-control">
                <label for="temp-slider"><img src="images/icon_tech_temp.png" class="custom-icon-sm"> Nhi·ªát</label>
                <input type="range" id="temp-slider" min="30" max="50" value="30" oninput="setTemperature(this.value)">
                <span id="temp-value">30¬∞C</span>
            </div>
        </div>
    </section>

    <!-- Journey Section (Separate, Larger) -->
    <section class="journey-section" id="journey">
        <h2 class="section-title">H√†nh Tr√¨nh <span>Gi·∫•c Ng·ªß</span></h2>
        <p class="subtitle">T·ª´ cƒÉng th·∫≥ng ƒë·∫øn gi·∫•c ng·ªß s√¢u - Tr·∫£i nghi·ªám c·ªßa b·∫°n v·ªõi DreamPillow</p>

        <div class="journey-carousel-large">
            <button class="carousel-btn-lg prev" onclick="changeJourneySlide(-1)">‚ùÆ</button>

            <div class="carousel-content">
                <div class="carousel-slide-lg active" data-step="1">
                    <img src="images/journey_sketch_stress_1768380607555.png" alt="Stress">
                    <div class="slide-info">
                        <h3>üò´ CƒÉng Th·∫≥ng</h3>
                        <p>ƒêau m·ªèi c·ªï vai g√°y sau ng√†y d√†i l√†m vi·ªác. C∆° th·ªÉ m·ªát m·ªèi nh∆∞ng kh√≥ th∆∞ gi√£n.</p>
                    </div>
                </div>
                <div class="carousel-slide-lg" data-step="2">
                    <img src="images/journey_sketch_insomnia_1768380625194.png" alt="Insomnia">
                    <div class="slide-info">
                        <h3>üåë Kh√≥ Ng·ªß</h3>
                        <p>Tr·∫±n tr·ªçc c·∫£ ƒë√™m, ng·ªß kh√¥ng s√¢u gi·∫•c, th·ª©c d·∫≠y v·∫´n m·ªát m·ªèi.</p>
                    </div>
                </div>
                <div class="carousel-slide-lg" data-step="3">
                    <img src="images/pillow_schematic_vn.png" alt="Pillow Tech">
                    <div class="slide-info">
                        <h3>üíÜ S·ª≠ D·ª•ng DreamPillow</h3>
                        <p>C√¥ng ngh·ªá massage ƒëa ƒëi·ªÉm v√† nhi·ªát h·ªìng ngo·∫°i gi√∫p th∆∞ gi√£n c∆° b·∫Øp.</p>
                    </div>
                </div>
                <div class="carousel-slide-lg" data-step="4">
                    <img src="images/journey_sketch_relax_1768380677794.png" alt="Relax">
                    <div class="slide-info">
                        <h3>‚ú® Th∆∞ Gi√£n</h3>
                        <p>C·∫£i thi·ªán tu·∫ßn ho√†n m√°u, gi·∫£m cƒÉng th·∫≥ng c·ªï vai g√°y m·ªôt c√°ch hi·ªáu qu·∫£.</p>
                    </div>
                </div>
                <div class="carousel-slide-lg" data-step="5">
                    <img src="images/journey_sketch_sleep_1768380693188.png" alt="Deep Sleep">
                    <div class="slide-info">
                        <h3>üí§ Ng·ªß S√¢u</h3>
                        <p>Ch·∫•t l∆∞·ª£ng gi·∫•c ng·ªß tuy·ªát v·ªùi, th·ª©c d·∫≠y tr√†n ƒë·∫ßy nƒÉng l∆∞·ª£ng.</p>
                    </div>
                </div>
            </div>

            <button class="carousel-btn-lg next" onclick="changeJourneySlide(1)">‚ùØ</button>
        </div>

        <div class="carousel-dots-lg">
            <span class="dot-lg active" onclick="goToJourneySlide(1)">1</span>
            <span class="dot-lg" onclick="goToJourneySlide(2)">2</span>
            <span class="dot-lg" onclick="goToJourneySlide(3)">3</span>
            <span class="dot-lg" onclick="goToJourneySlide(4)">4</span>
            <span class="dot-lg" onclick="goToJourneySlide(5)">5</span>
        </div>
    </section>

    <!-- Materials Section -->
    <section class="materials-section" id="materials">
        <h2 class="section-title scroll-animate">Ch·∫•t Li·ªáu <span>ƒê·∫≥ng C·∫•p</span></h2>
        <p class="subtitle scroll-animate">S·ª± k·∫øt h·ª£p ho√†n h·∫£o gi·ªØa c√¥ng ngh·ªá v√† t·ª± nhi√™n</p>

        <div class="materials-grid">
            <div class="material-card scroll-animate">
                <span class="material-icon">‚òÅÔ∏è</span>
                <h3>Memory Foam 100%</h3>
                <p>L√µi g·ªëi Memory Foam cao c·∫•p v·ªõi ƒë·ªô ƒë√†n h·ªìi ch·∫≠m, √¥m s√°t ƒë∆∞·ªùng cong c·ªï vai g√°y, gi√∫p gi·∫£m √°p l·ª±c t·ªëi
                    ƒëa.</p>
            </div>

            <div class="material-card scroll-animate">
                <span class="material-icon">üåø</span>
                <h3>V·∫£i Tencel Cao C·∫•p</h3>
                <p>V·ªè g·ªëi l√†m t·ª´ s·ª£i Tencel t·ª± nhi√™n, m·ªÅm m·∫°i nh∆∞ l·ª•a, tho√°ng kh√≠ g·∫•p 3 l·∫ßn cotton v√† kh√°ng khu·∫©n v∆∞·ª£t
                    tr·ªôi.</p>
            </div>

            <div class="material-card scroll-animate">
                <span class="material-icon">‚ùÑÔ∏è</span>
                <h3>C√¥ng Ngh·ªá Gel Cool</h3>
                <p>L·ªõp Gel l√†m m√°t t√≠ch h·ª£p gi√∫p ƒëi·ªÅu h√≤a nhi·ªát ƒë·ªô, mang l·∫°i c·∫£m gi√°c m√°t m·∫ª d·ªÖ ch·ªãu su·ªët ƒë√™m d√†i.</p>
            </div>
        </div>


    </section>

    <!-- Features Section -->
    <section class="features" id="features">
        <h2 class="section-title scroll-animate">C√¥ng Ngh·ªá <span>Ti√™n Ti·∫øn</span></h2>
        <div class="features-grid">
            <div class="feature-card scroll-animate">
                <img src="images/icon_tech_alarm.png" alt="Alarm" class="custom-icon-feature">
                <h3>B√°o Th·ª©c Nh·∫π Nh√†ng</h3>
                <p>H·ªá th·ªëng rung nh·∫π v√† √°nh s√°ng d·∫ßn tƒÉng, ƒë√°nh th·ª©c b·∫°n m·ªôt c√°ch t·ª± nhi√™n m√† kh√¥ng g√¢y s·ªëc hay kh√≥
                    ch·ªãu.</p>
            </div>
            <div class="feature-card scroll-animate">
                <img src="images/icon_tech_massage.png" alt="Massage" class="custom-icon-feature">
                <h3>Massage Th∆∞ Gi√£n</h3>
                <p>T√≠ch h·ª£p c√¥ng ngh·ªá massage ƒëa ƒëi·ªÉm, gi·∫£m cƒÉng th·∫≥ng v√πng c·ªï v√† vai, gi√∫p th∆∞ gi√£n to√†n b·ªô c∆° th·ªÉ.</p>
            </div>
            <div class="feature-card scroll-animate">
                <img src="images/icon_tech_music.png" alt="Music" class="custom-icon-feature">
                <h3>Nh·∫°c Lofi Du D∆∞∆°ng</h3>
                <p>Loa t√≠ch h·ª£p ph√°t nh·∫°c lofi nh·∫π nh√†ng v·ªõi √¢m thanh trong tr·∫ªo, ƒë∆∞a b·∫°n v√†o gi·∫•c ng·ªß s√¢u v√† b√¨nh y√™n.
                </p>
                <div class="music-visualizer">
                    <div class="bar"></div>
                    <div class="bar"></div>
                    <div class="bar"></div>
                    <div class="bar"></div>
                    <div class="bar"></div>
                    <div class="bar"></div>
                    <div class="bar"></div>
                </div>
            </div>
            <div class="feature-card scroll-animate">
                <img src="images/icon_tech_scent.png" alt="Scent" class="custom-icon-feature">
                <h3>H∆∞∆°ng Th∆°m D·ªÖ Ch·ªãu</h3>
                <p>H·ªá th·ªëng khu·∫øch t√°n tinh d·∫ßu t·ª± nhi√™n v·ªõi c√°c m√πi h∆∞∆°ng nh∆∞ lavender, b·∫°c h√† gi√∫p th∆∞ gi√£n tinh th·∫ßn.
                </p>
            </div>
            <div class="feature-card scroll-animate">
                <img src="images/icon_tech_temp.png" alt="Temperature" class="custom-icon-feature">
                <h3>ƒêi·ªÅu Ch·ªânh Nhi·ªát ƒê·ªô</h3>
                <p>H·ªá th·ªëng nhi·ªát h·ªìng ngo·∫°i c√≥ th·ªÉ ƒëi·ªÅu ch·ªânh t·ª´ 30¬∞C ƒë·∫øn 50¬∞C, gi√∫p l√†m ·∫•m c·ªï v√† vai, th∆∞ gi√£n c∆° b·∫Øp.
                </p>
            </div>
        </div>
    </section>

    <!-- Benefits Section -->
    <section class="benefits" id="benefits">
        <div class="benefits-content scroll-animate">
            <h2 class="section-title">V√¨ Sao Ch·ªçn <span>DreamPillow</span>?</h2>
            <ul class="benefit-list">
                <li>C·∫£i thi·ªán ch·∫•t l∆∞·ª£ng gi·∫•c ng·ªß l√™n ƒë·∫øn 80%</li>
                <li>Gi·∫£m ƒëau ƒë·∫ßu v√† cƒÉng th·∫≥ng v√πng c·ªï</li>
                <li>Th·ª©c d·∫≠y tr√†n ƒë·∫ßy nƒÉng l∆∞·ª£ng m·ªói s√°ng</li>
                <li>V·∫£i cao c·∫•p, tho√°ng kh√≠ v√† kh√°ng khu·∫©n</li>
                <li>ƒêi·ªÅu khi·ªÉn th√¥ng minh qua smartphone</li>
            </ul>
        </div>
    </section>

    <!-- Footer -->
    <footer id="contact">
        <p>¬© 2026 DreamPillow - Gi·∫•c Ng·ªß Ho√†n H·∫£o</p>
        <p style="margin-top: 10px; color: var(--accent);">Designed for DTTK Nhom7</p>
    </footer>


    <audio id="lofi-audio" loop>
        <source
            src="https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3?filename=lofi-study-112191.mp3"
            type="audio/mpeg">
    </audio>

    <!-- User Guide Section -->
    <section class="guide-section" id="guide">
        <h2 class="section-title scroll-animate">H∆∞·ªõng D·∫´n <span>S·ª≠ D·ª•ng</span></h2>
        <p class="subtitle scroll-animate">Ch·ªâ v·ªõi 3 b∆∞·ªõc ƒë∆°n gi·∫£n ƒë·ªÉ b·∫Øt ƒë·∫ßu h√†nh tr√¨nh gi·∫•c ng·ªß ho√†n h·∫£o</p>

        <div class="guide-steps">
            <div class="guide-step scroll-animate">
                <img src="images/guide_connect.png" class="step-icon" alt="Step 1">
                <h3>K·∫øt N·ªëi ·ª®ng D·ª•ng</h3>
                <p>T·∫£i ·ª©ng d·ª•ng DreamPillow tr√™n App Store ho·∫∑c Google Play. B·∫≠t Bluetooth v√† k·∫øt n·ªëi v·ªõi g·ªëi trong 3s.
                </p>
            </div>

            <div class="guide-step scroll-animate">
                <img src="images/guide_settings.png" class="step-icon" alt="Step 2">
                <h3>C√†i ƒê·∫∑t C√° Nh√¢n</h3>
                <p>Ch·ªçn ch·∫ø ƒë·ªô y√™u th√≠ch c·ªßa b·∫°n: Nhi·ªát ƒë·ªô, Rung massage, √Çm thanh v√† M√πi h∆∞∆°ng. T√πy ch·ªânh h·∫πn gi·ªù.
                </p>
            </div>

            <div class="guide-step scroll-animate">
                <img src="images/guide_enjoy.png" class="step-icon" alt="Step 3">
                <h3>T·∫≠n H∆∞·ªüng</h3>
                <p>ƒê·∫∑t l∆∞ng xu·ªëng, th·∫£ l·ªèng c∆° th·ªÉ v√† ƒë·ªÉ DreamPillow ƒë∆∞a b·∫°n v√†o gi·∫•c ng·ªß s√¢u th∆∞ th√°i nh·∫•t.</p>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer style="text-align: center; padding: 50px 0; color: #888; font-size: 0.9rem;">
        <p>&copy; 2024 TDTK Nh√≥m 7. All rights reserved.</p>
    </footer>

    <script>







        // ========== THREE.JS 3D PILLOW ==========
        let scene, camera, renderer, pillow, pillowGroup;
        let isAutoRotate = true;
        let currentStage = 1;
        let journeyTime = 0;
        let isDragging = false;
        let previousMousePosition = { x: 0, y: 0 };
        let targetRotation = { x: 0, y: 0 };
        let activeEffect = null; // 'music', 'alarm', 'massage', 'scent'
        let effectTime = 0;
        let scentParticles = [];
        // X-Ray Effect
        let schematicPlane = null;
        let currentZoom = 1; // 1 = normal, <1 = zoomed in





        function init3D() {
            const canvas = document.getElementById('pillow-canvas');
            const container = canvas.parentElement;

            // Scene
            scene = new THREE.Scene();

            // Camera - Top-down angled view
            camera = new THREE.PerspectiveCamera(45, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(0, 2.5, 3.5);
            camera.lookAt(0, 0, 0);

            // Renderer
            renderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.setClearColor(0x000000, 0);

            // Lighting - Warm Studio Setup
            const ambientLight = new THREE.AmbientLight(0xfff5e6, 0.8);
            scene.add(ambientLight);

            const mainLight = new THREE.SpotLight(0xfffaed, 1.2);
            mainLight.position.set(5, 8, 5);
            mainLight.castShadow = true;
            mainLight.penumbra = 0.5;
            scene.add(mainLight);

            const fillLight = new THREE.PointLight(0xc4a77d, 0.6);
            fillLight.position.set(-5, 2, -5);
            scene.add(fillLight);

            // Create Pillow Group
            pillowGroup = new THREE.Group();
            scene.add(pillowGroup);

            // Load External GLB Model
            const loader = new THREE.GLTFLoader();
            loader.load('pillow.glb', (gltf) => {
                pillow = gltf.scene;

                // Auto-center and scale to fit scene
                const box = new THREE.Box3().setFromObject(pillow);
                const size = box.getSize(new THREE.Vector3());
                const maxDim = Math.max(size.x, size.y, size.z);
                const scale = 2.4 / maxDim; // Fit width approx 2.4 units
                pillow.scale.setScalar(scale);

                // Center pivot
                const center = box.getCenter(new THREE.Vector3());
                pillow.position.x = -center.x * scale;
                pillow.position.z = -center.z * scale;
                pillow.position.y = -box.min.y * scale + 0.1;

                // Apply Shadows & Material Tweaks
                pillow.traverse((node) => {
                    if (node.isMesh) {
                        node.castShadow = true;
                        node.receiveShadow = true;
                        if (node.material) {
                            if (node.material.map) node.material.emissiveMap = node.material.map;
                        }
                    }
                });

                pillowGroup.add(pillow);
                addDecorations();
                console.log("Model loaded successfully");

            }, undefined, (error) => {
                console.error('Error loading pillow.glb', error);
                // Fallback box test
                const geo = new THREE.BoxGeometry(2.4, 0.5, 1.6);
                const mat = new THREE.MeshStandardMaterial({ color: 0xf8f4ed });
                pillow = new THREE.Mesh(geo, mat);
                pillowGroup.add(pillow);
                addDecorations();
            });

            // Controls
            setupControls(canvas);

            // Start Animation Loop
            animate();
        }

        // Middle Logic Removed for Journey Mode

        function animate() {
            requestAnimationFrame(animate);
            const time = Date.now() * 0.001;
            effectTime += 0.05;

            // 1. Rotation Logic
            if (isAutoRotate) targetRotation.y += 0.003;
            // Smooth dampening
            pillowGroup.rotation.y += (targetRotation.y - pillowGroup.rotation.y) * 0.1;
            pillowGroup.rotation.x += (targetRotation.x - pillowGroup.rotation.x) * 0.1;

            // 2. Base Floating Animation (always active)
            const floatY = Math.sin(time) * 0.05;
            pillowGroup.position.y = floatY;

            // Reset emissive if not alarm
            if (pillow && activeEffect !== 'alarm') {
                pillow.traverse((node) => {
                    if (node.isMesh && node.material && node.material.emissive) {
                        node.material.emissive.lerp(new THREE.Color(0x000000), 0.1);
                        node.material.emissiveIntensity = 0;
                    }
                });
            }

            // 3. Active Effect Animations
            if (activeEffect) {
                if (activeEffect === 'music') {
                    // Gentle rhythmic bounce
                    const scale = 1 + Math.sin(effectTime * 3) * 0.015;
                    pillowGroup.scale.set(scale, scale, scale);
                }
                else if (activeEffect === 'alarm') {
                    // Gentle Vibration + Glow Pulse
                    // Vibration (low amplitude, medium speed)
                    pillowGroup.position.x = (Math.random() - 0.5) * 0.015;

                    // Glow Pulse
                    const pulse = (Math.sin(effectTime * 5) + 1) * 0.5; // 0 to 1
                    if (pillow) {
                        pillow.traverse((node) => {
                            if (node.isMesh && node.material && node.material.emissive) {
                                node.material.emissive.setHex(0xffd700);
                                node.material.emissiveIntensity = pulse * 0.4;
                            }
                        });
                    }
                }
                else if (activeEffect === 'massage') {
                    // Soothing Kneading Motion (Slow wavy rotation)
                    pillowGroup.rotation.z = Math.sin(effectTime * 1.5) * 0.03;
                    // Subtle vertical knead movement
                    pillowGroup.position.y += Math.sin(effectTime * 3) * 0.01;
                }
                else if (activeEffect === 'scent') {
                    // Spawn particles
                    spawnScentParticle();
                }
            } else {
                // Reset standard scale/pos
                pillowGroup.scale.lerp(new THREE.Vector3(1, 1, 1), 0.1);
                pillowGroup.rotation.z *= 0.9;
            }

            // 4. Handle Scent Particles
            updateParticles();

            renderer.render(scene, camera);
        }

        function spawnScentParticle() {
            if (Math.random() > 0.1) return; // not too many
            const particle = document.createElement('div');
            // We can't easily add DOM elements to 3D scene properly without CSS3DRenderer
            // So we use Three.js particles
            const pGeo = new THREE.SphereGeometry(0.03, 8, 8);
            const pMat = new THREE.MeshBasicMaterial({ color: 0xffb6c1, transparent: true, opacity: 0.6 });
            const p = new THREE.Mesh(pGeo, pMat);

            // Random start pos on pillow surface
            p.position.set((Math.random() - 0.5) * 1.5, 0.6, (Math.random() - 0.5) * 0.8);
            p.userData = { life: 1.0, dy: 0.01 + Math.random() * 0.02 };
            pillowGroup.add(p);
            scentParticles.push(p);
        }

        function updateParticles() {
            for (let i = scentParticles.length - 1; i >= 0; i--) {
                const p = scentParticles[i];
                p.position.y += p.userData.dy;
                p.userData.life -= 0.02;
                p.material.opacity = p.userData.life * 0.6;
                p.scale.setScalar(p.userData.life); // shrink

                if (p.userData.life <= 0) {
                    pillowGroup.remove(p);
                    scentParticles.splice(i, 1);
                }
            }
        }

        // Input Handlers (Removed for Journey Mode)

        function onWindowResize() {
            const container = document.getElementById('pillow-canvas').parentElement;
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }


        // ========== JOURNEY LOGIC (Appended) ==========

        // Disable Auto Rotate Default
        isAutoRotate = false;

        // Journey Control Logic
        window.setJourneyStep = function (step) {
            if (currentStage === step) return;
            currentStage = step;
            journeyTime = 0;

            // Update UI
            document.querySelectorAll('.journey-item').forEach(el => el.classList.remove('active'));
            const stepEl = document.getElementById('step-' + step);
            if (stepEl) stepEl.classList.add('active');
        }

        // Overwrite init3D and animate (Hoisting will replace old versions)
        function init3D() {
            const canvas = document.getElementById('pillow-canvas');
            const container = canvas.parentElement;

            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(45, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(0, 2.5, 3.5);
            camera.lookAt(0, 0, 0);

            renderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.setClearColor(0x000000, 0);

            const ambientLight = new THREE.AmbientLight(0xfff5e6, 0.8);
            scene.add(ambientLight);

            const mainLight = new THREE.SpotLight(0xfffaed, 1.2);
            mainLight.position.set(5, 8, 5);
            mainLight.castShadow = true;
            mainLight.penumbra = 0.5;
            scene.add(mainLight);

            const fillLight = new THREE.PointLight(0xc4a77d, 0.6);
            fillLight.position.set(-5, 2, -5);
            scene.add(fillLight);

            pillowGroup = new THREE.Group();
            scene.add(pillowGroup);

            const loader = new THREE.GLTFLoader();
            loader.load('pillow.glb', (gltf) => {
                pillow = gltf.scene;
                // Scale/Center Logic
                const box = new THREE.Box3().setFromObject(pillow);
                const size = box.getSize(new THREE.Vector3());
                const maxDim = Math.max(size.x, size.y, size.z);
                const scale = 2.4 / maxDim;
                pillow.scale.setScalar(scale);
                const center = box.getCenter(new THREE.Vector3());
                pillow.position.x = -center.x * scale;
                pillow.position.z = -center.z * scale;
                pillow.position.y = -box.min.y * scale + 0.1;

                pillow.traverse((node) => {
                    if (node.isMesh) {
                        node.castShadow = true;
                        node.receiveShadow = true;
                        if (node.material && node.material.map) node.material.emissiveMap = node.material.map;
                    }
                });
                pillowGroup.add(pillow);
                setJourneyStep(1); // Start Stage 1
                console.log("Model Loaded & Journey Started");
            }, undefined, function (error) {
                console.error("Error loading model", error);
            });

            // Listeners
            window.addEventListener('resize', onWindowResize);

            // Start Animation Loop
            animate();
        }

        function animate() {
            requestAnimationFrame(animate);
            const time = Date.now() * 0.001;
            journeyTime += 0.05;

            // Base Float
            if (pillowGroup) pillowGroup.position.y = Math.sin(time) * 0.05;

            if (pillow) {
                // Apply Stage Logic
                if (currentStage === 1) { // Stress
                    const jitter = Math.sin(journeyTime * 20) * 0.002;
                    pillowGroup.position.x = jitter;
                    pillowGroup.rotation.z = jitter * 2;
                    pillow.traverse((node) => { if (node.isMesh && node.material && node.material.emissive) { node.material.emissive.lerp(new THREE.Color(0xff3333), 0.1); node.material.emissiveIntensity = 0.2 + Math.sin(journeyTime * 10) * 0.1; } });
                } else if (currentStage === 2) { // Insomnia
                    pillowGroup.rotation.z = Math.sin(journeyTime * 2) * 0.1;
                    pillowGroup.position.x = 0;
                    pillow.traverse((node) => { if (node.isMesh && node.material && node.material.emissive) { node.material.emissive.lerp(new THREE.Color(0x112255), 0.1); node.material.emissiveIntensity = 0.3; } });
                } else if (currentStage === 3) { // Solution
                    pillowGroup.rotation.z = Math.sin(journeyTime * 1.5) * 0.03;
                    pillowGroup.position.y += Math.sin(journeyTime * 3) * 0.01;
                    pillowGroup.position.x = 0;
                    pillow.traverse((node) => { if (node.isMesh && node.material && node.material.emissive) { node.material.emissive.lerp(new THREE.Color(0xffaa00), 0.1); node.material.emissiveIntensity = 0.3 + Math.sin(journeyTime * 3) * 0.1; } });
                } else if (currentStage === 4) { // Relax
                    const targetScale = 1 + Math.sin(journeyTime * 2) * 0.02;
                    pillowGroup.scale.lerp(new THREE.Vector3(targetScale, targetScale, targetScale), 0.1);
                    pillowGroup.position.x = 0;
                    pillow.traverse((node) => { if (node.isMesh && node.material && node.material.emissive) { node.material.emissive.lerp(new THREE.Color(0x44ffaa), 0.1); node.material.emissiveIntensity = 0.2; } });
                } else if (currentStage === 5) { // Deep
                    pillowGroup.position.y = Math.sin(time * 0.5) * 0.08;
                    pillowGroup.scale.lerp(new THREE.Vector3(1, 1, 1), 0.1);
                    pillow.traverse((node) => { if (node.isMesh && node.material && node.material.emissive) { node.material.emissive.lerp(new THREE.Color(0xaaccff), 0.05); node.material.emissiveIntensity = 0.4 + Math.sin(time) * 0.1; } });
                }
            }
            renderer.render(scene, camera);
        }

        // ========== RESTORED LOGIC (Journey + Legacy) ==========

        // Ensure Global State is Respected
        // Global vars: scene, camera, renderer, pillowGroup, isAutoRotate, activeEffect, targetRotation, etc.

        // Default Defaults
        isAutoRotate = false;

        // Journey Control Logic
        window.setJourneyStep = function (step) {
            if (activeEffect) {
                // Optional: Deactivate features when changing journey? Or keep them?
                // Let's keep features valid but maybe notify user?
                // For now, simple state change.
            }
            if (currentStage === step) return;
            currentStage = step;
            journeyTime = 0;

            // Update UI
            document.querySelectorAll('.journey-item').forEach(el => el.classList.remove('active'));
            const stepEl = document.getElementById('step-' + step);
            if (stepEl) stepEl.classList.add('active');
        }

        // Toggle Auto Rotate
        window.toggleAuto = function () {
            isAutoRotate = !isAutoRotate;
            const btn = document.getElementById('auto-rotate');
            if (btn) btn.classList.toggle('active', isAutoRotate);
        }

        // Manual Rotate Helper
        window.rotateLeft = function () { targetRotation.y -= 0.5; stopAuto(); }
        window.rotateRight = function () { targetRotation.y += 0.5; stopAuto(); }
        function stopAuto() { isAutoRotate = false; const btn = document.getElementById('auto-rotate'); if (btn) btn.classList.remove('active'); }

        // Activate Feature
        // ALARM SOUND GENERATOR (Web Audio API)
        let alarmCtx, alarmOsc, alarmGain;
        function playGentleAlarm() {
            if (alarmCtx) return;
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!AudioContext) return;

            alarmCtx = new AudioContext();
            alarmOsc = alarmCtx.createOscillator();
            alarmGain = alarmCtx.createGain();

            alarmOsc.connect(alarmGain);
            alarmGain.connect(alarmCtx.destination);

            // Gentle Sine Wave
            alarmOsc.type = 'sine';
            alarmOsc.frequency.setValueAtTime(440, alarmCtx.currentTime); // A4

            // Create a gentle double-beep pulse pattern
            const now = alarmCtx.currentTime;
            alarmGain.gain.setValueAtTime(0, now);

            // Loop for 60 seconds (simple automation)
            for (let i = 0; i < 30; i++) {
                const t = now + i * 2;
                // Beep 1
                alarmGain.gain.linearRampToValueAtTime(0.2, t + 0.1);
                alarmGain.gain.linearRampToValueAtTime(0, t + 0.4);
                // Beep 2
                alarmGain.gain.linearRampToValueAtTime(0.2, t + 0.5);
                alarmGain.gain.linearRampToValueAtTime(0, t + 0.9);
            }

            alarmOsc.start();
        }

        function stopAlarm() {
            if (alarmOsc) { try { alarmOsc.stop(); } catch (e) { } alarmOsc = null; }
            if (alarmCtx) { if (alarmCtx.state !== 'closed') alarmCtx.close(); alarmCtx = null; }
        }

        // Activate Feature
        window.activateFeature = function (type) {
            // STOP EVERYTHING FIRST
            const audio = document.getElementById('lofi-audio');
            if (audio) { audio.pause(); audio.currentTime = 0; }
            stopAlarm();

            if (activeEffect === type) {
                activeEffect = null;
                document.querySelectorAll('.feature-btn').forEach(b => b.classList.remove('active'));
                showOverlay("");
            } else {
                activeEffect = type;
                effectTime = 0;
                document.querySelectorAll('.feature-btn').forEach(b => b.classList.remove('active'));
                const btn = document.querySelector('.' + type + '-btn');
                if (btn) btn.classList.add('active');

                // Audio Logic
                if (type === 'music') {
                    if (audio) { audio.volume = 0.5; audio.play().catch(e => console.log("Audio Error", e)); }
                } else if (type === 'alarm') {
                    playGentleAlarm();
                }

                // Overlay
                const msgs = { 'music': 'üéµ Nh·∫°c Lofi', 'alarm': '‚è∞ B√°o Th·ª©c', 'massage': 'üíÜ Massage', 'scent': 'üå∏ H∆∞∆°ng Th∆°m' };
                showOverlay(msgs[type]);
            }
        }

        function showOverlay(msg) {
            const el = document.getElementById('pillow-overlay-msg');
            if (el) {
                if (!msg) el.style.opacity = 0;
                else { el.textContent = msg; el.style.opacity = 1; setTimeout(() => { if (!activeEffect) el.style.opacity = 0; }, 3000); }
            }
        }

        // Overwrite init3D and animate
        function init3D() {
            const canvas = document.getElementById('pillow-canvas');
            const container = canvas.parentElement;

            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(45, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(0, 2.5, 3.5);
            camera.lookAt(0, 0, 0);

            renderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.setClearColor(0x000000, 0);

            const ambientLight = new THREE.AmbientLight(0xfff5e6, 0.8);
            scene.add(ambientLight);

            const mainLight = new THREE.SpotLight(0xfffaed, 1.2);
            mainLight.position.set(5, 8, 5);
            mainLight.castShadow = true;
            mainLight.penumbra = 0.5;
            scene.add(mainLight);

            const fillLight = new THREE.PointLight(0xc4a77d, 0.6);
            fillLight.position.set(-5, 2, -5);
            scene.add(fillLight);

            pillowGroup = new THREE.Group();
            scene.add(pillowGroup);

            const loader = new THREE.GLTFLoader();
            // Custom Texture Logic: Pattern + Skin Tone Color
            function createTintedTexture(url, color) {
                const texture = new THREE.Texture();
                const image = new Image();
                image.src = url;
                image.crossOrigin = "Anonymous";
                image.onload = function () {
                    const canvas = document.createElement('canvas');
                    canvas.width = image.width;
                    canvas.height = image.height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(image, 0, 0);

                    // 1. Desaturate to get grayscale pattern
                    ctx.globalCompositeOperation = 'saturation';
                    ctx.fillStyle = 'hsl(0,0%,50%)';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);

                    // 2. Tint with Skin Tone (Beige/Nude)
                    ctx.globalCompositeOperation = 'multiply';
                    ctx.fillStyle = color;
                    ctx.fillRect(0, 0, canvas.width, canvas.height);

                    texture.image = canvas;
                    texture.needsUpdate = true;
                    texture.wrapS = THREE.RepeatWrapping;
                    texture.wrapT = THREE.RepeatWrapping;
                    texture.repeat.set(2, 2);
                    texture.flipY = false;
                };
                return texture;
            }

            // Load Skin Tone Texture (#ebd6c4 is a soft beige)
            const customTexture = createTintedTexture('images/pillow_texture_lavender.jpg?v=2', '#ebd6c4');

            loader.load('pillow.glb', (gltf) => {
                pillow = gltf.scene;
                // Scale/Center Logic
                const box = new THREE.Box3().setFromObject(pillow);
                const size = box.getSize(new THREE.Vector3());
                const maxDim = Math.max(size.x, size.y, size.z);
                const scale = 2.4 / maxDim;
                pillow.scale.setScalar(scale);
                const center = box.getCenter(new THREE.Vector3());
                pillow.position.x = -center.x * scale;
                pillow.position.z = -center.z * scale;
                pillow.position.y = -box.min.y * scale + 0.1;

                pillow.traverse((node) => {
                    if (node.isMesh) {
                        node.castShadow = true;
                        node.receiveShadow = true;

                        // Apply Custom Texture
                        node.material.map = customTexture;
                        // Maintain subtle emission style if used
                        node.material.emissive = new THREE.Color(0x222222);
                        node.material.emissiveMap = customTexture;
                        node.material.needsUpdate = true;
                    }
                });
                pillowGroup.add(pillow);
                setJourneyStep(1); // Start Stage 1
                console.log("Model Loaded & Restored");
            }, undefined, function (error) {
                console.error("Error loading model", error);
            });

            // Listeners
            window.addEventListener('resize', onWindowResize);

            // Mouse/Touch Interaction
            canvas.addEventListener('mousedown', onMouseDown);
            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mouseup', onMouseUp);
            canvas.addEventListener('touchstart', onTouchStart, { passive: false });
            document.addEventListener('touchmove', onTouchMove, { passive: false });
            document.addEventListener('touchend', onTouchEnd);

            // Bind Rotation Buttons if valid
            const btnLeft = document.getElementById('rotate-left');
            if (btnLeft) btnLeft.onclick = rotateLeft;
            const btnRight = document.getElementById('rotate-right');
            if (btnRight) btnRight.onclick = rotateRight;
            const btnAuto = document.getElementById('auto-rotate');
            if (btnAuto) btnAuto.onclick = toggleAuto;

            // Start Animation Loop
            animate();
        }

        // Input Handlers
        function onMouseDown(e) { isDragging = true; stopAuto(); previousMousePosition = { x: e.clientX, y: e.clientY }; }
        function onMouseMove(e) {
            if (isDragging) {
                const dx = e.clientX - previousMousePosition.x;
                const dy = e.clientY - previousMousePosition.y;
                targetRotation.y += dx * 0.01;
                targetRotation.x += dy * 0.01;
                targetRotation.x = Math.max(-0.5, Math.min(0.5, targetRotation.x));
                previousMousePosition = { x: e.clientX, y: e.clientY };
            }
        }
        function onMouseUp() { isDragging = false; }

        function onTouchStart(e) { isDragging = true; stopAuto(); previousMousePosition = { x: e.touches[0].clientX, y: e.touches[0].clientY }; e.preventDefault(); }
        function onTouchMove(e) {
            if (isDragging) {
                const dx = e.touches[0].clientX - previousMousePosition.x;
                const dy = e.touches[0].clientY - previousMousePosition.y;
                targetRotation.y += dx * 0.01;
                targetRotation.x += dy * 0.01;
                targetRotation.x = Math.max(-0.5, Math.min(0.5, targetRotation.x));
                previousMousePosition = { x: e.touches[0].clientX, y: e.touches[0].clientY };
                e.preventDefault();
            }
        }
        function onTouchEnd() { isDragging = false; }


        function animate() {
            requestAnimationFrame(animate);
            const time = Date.now() * 0.001;
            journeyTime += 0.05;
            effectTime += 0.05;

            // Rotation Logic (Restored)
            if (isAutoRotate) targetRotation.y += 0.003;
            // Smooth dampening
            pillowGroup.rotation.y += (targetRotation.y - pillowGroup.rotation.y) * 0.1;
            pillowGroup.rotation.x += (targetRotation.x - pillowGroup.rotation.x) * 0.1;

            // Base Float
            if (pillowGroup) pillowGroup.position.y = Math.sin(time) * 0.05;

            if (pillow) {
                // Priority: Active Feature > Journey Stage
                if (activeEffect) {
                    // Active Feature Visuals
                    if (activeEffect === 'music') {
                        const scale = 1 + Math.sin(effectTime * 3) * 0.015;
                        pillowGroup.scale.set(scale, scale, scale);
                    } else if (activeEffect === 'alarm') {
                        pillowGroup.position.x = (Math.random() - 0.5) * 0.015; // Shaking
                        const pulse = (Math.sin(effectTime * 5) + 1) * 0.5;
                        pillow.traverse((node) => { if (node.isMesh && node.material && node.material.emissive) { node.material.emissive.setHex(0xffd700); node.material.emissiveIntensity = pulse * 0.4; } });
                    } else if (activeEffect === 'massage') {
                        pillowGroup.position.y += Math.sin(effectTime * 3) * 0.01;
                    }
                    // Scent handled by particles elsewhere or ignored for now
                } else {
                    // Journey Visuals (Fallback)
                    if (currentStage === 1) { // Stress
                        const jitter = Math.sin(journeyTime * 20) * 0.002;
                        pillowGroup.position.x = jitter; // Note: Rotation handled mainly by manual now, but we can add subtle z twist
                        pillowGroup.rotation.z = jitter * 2;
                        pillow.traverse((node) => { if (node.isMesh && node.material && node.material.emissive) { node.material.emissive.lerp(new THREE.Color(0xff3333), 0.1); node.material.emissiveIntensity = 0.2 + Math.sin(journeyTime * 10) * 0.1; } });
                    } else if (currentStage === 2) { // Insomnia
                        pillowGroup.rotation.z = Math.sin(journeyTime * 2) * 0.1;
                        pillow.traverse((node) => { if (node.isMesh && node.material && node.material.emissive) { node.material.emissive.lerp(new THREE.Color(0x112255), 0.1); node.material.emissiveIntensity = 0.3; } });
                    } else if (currentStage === 3) { // Solution
                        pillowGroup.rotation.z = Math.sin(journeyTime * 1.5) * 0.03;
                        pillowGroup.position.y += Math.sin(journeyTime * 3) * 0.01;
                        pillow.traverse((node) => { if (node.isMesh && node.material && node.material.emissive) { node.material.emissive.lerp(new THREE.Color(0xffaa00), 0.1); node.material.emissiveIntensity = 0.3 + Math.sin(journeyTime * 3) * 0.1; } });
                    } else if (currentStage === 4) { // Relax
                        const targetScale = 1 + Math.sin(journeyTime * 2) * 0.02;
                        pillowGroup.scale.lerp(new THREE.Vector3(targetScale, targetScale, targetScale), 0.1);
                        pillow.traverse((node) => { if (node.isMesh && node.material && node.material.emissive) { node.material.emissive.lerp(new THREE.Color(0x44ffaa), 0.1); node.material.emissiveIntensity = 0.2; } });
                    } else if (currentStage === 5) { // Deep
                        pillowGroup.scale.lerp(new THREE.Vector3(1, 1, 1), 0.1);
                        pillow.traverse((node) => { if (node.isMesh && node.material && node.material.emissive) { node.material.emissive.lerp(new THREE.Color(0xaaccff), 0.05); node.material.emissiveIntensity = 0.4 + Math.sin(time) * 0.1; } });
                    }
                }
            }
            renderer.render(scene, camera);
        }

        // ========== PARTICLES (Background) ==========
        function createParticles() {
            const container = document.getElementById('particles');
            const particleCount = 20;
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 15 + 's';
                particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                container.appendChild(particle);
            }
        }

        // ========== FIXED LOGIC (Position, Color, Idle) ==========

        // Overwrite init3D and animate again to apply user fixes
        function init3D() {
            const canvas = document.getElementById('pillow-canvas');
            const container = canvas.parentElement;

            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(45, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(0, 2.5, 3.5);
            camera.lookAt(0, 0, 0);

            renderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.setClearColor(0x000000, 0);

            const ambientLight = new THREE.AmbientLight(0xfff5e6, 0.8);
            scene.add(ambientLight);

            const mainLight = new THREE.SpotLight(0xfffaed, 1.2);
            mainLight.position.set(5, 8, 5);
            mainLight.castShadow = true;
            mainLight.penumbra = 0.5;
            scene.add(mainLight);

            const fillLight = new THREE.PointLight(0xc4a77d, 0.6);
            fillLight.position.set(-5, 2, -5);
            scene.add(fillLight);

            pillowGroup = new THREE.Group();
            scene.add(pillowGroup);

            const loader = new THREE.GLTFLoader();
            loader.load('pillow.glb', (gltf) => {
                pillow = gltf.scene;
                // Scale/Center Logic
                const box = new THREE.Box3().setFromObject(pillow);
                const size = box.getSize(new THREE.Vector3());
                const maxDim = Math.max(size.x, size.y, size.z);
                const scale = 2.4 / maxDim;
                pillow.scale.setScalar(scale);
                const center = box.getCenter(new THREE.Vector3());
                pillow.position.x = -center.x * scale;
                pillow.position.z = -center.z * scale;

                // FIX 1: Lower Pillow by ~10% (adjust offset)
                pillow.position.y = -box.min.y * scale + 0.1 - 0.5;

                pillow.traverse((node) => {
                    if (node.isMesh) {
                        node.castShadow = true;
                        node.receiveShadow = true;
                        if (node.material && node.material.map) node.material.emissiveMap = node.material.map;

                        // FIX 2: Force White Color (Remove Texture Map to avoid brown tint)
                        if (node.material) {
                            if (node.material.map) node.material.map = null;
                            if (node.material.color) node.material.color.setHex(0xffffff);
                        }
                    }
                });
                pillowGroup.add(pillow);

                // X-RAY EFFECT: Create schematic plane inside pillow
                const textureLoader = new THREE.TextureLoader();
                textureLoader.load('images/pillow_schematic_vn.png?v=10', (texture) => {
                    const planeGeo = new THREE.PlaneGeometry(1.5, 1.2); // Smaller card size
                    const planeMat = new THREE.MeshBasicMaterial({
                        map: texture,
                        transparent: true, // Use transparent for normal blending
                        opacity: 0,
                        side: THREE.DoubleSide,
                        blending: THREE.NormalBlending, // Normal blending for white paper look
                        depthWrite: false
                    });
                    schematicPlane = new THREE.Mesh(planeGeo, planeMat);
                    schematicPlane.position.set(0, 0, 0);
                    schematicPlane.rotation.x = THREE.MathUtils.degToRad(-10);
                    pillowGroup.add(schematicPlane);
                    console.log("Schematic plane loaded (White Paper Mode)");
                });

                // Set pillow material to be transparent-capable
                pillow.traverse((node) => {
                    if (node.isMesh && node.material) {
                        node.material.transparent = true;
                    }
                });

                // FIX 3: Start Idle (Stage 0)
                setJourneyStep(0);
                console.log("Model Loaded & Fixes Applied");
            }, undefined, function (error) { console.error("Error loading model", error); });

            // X-RAY ZOOM: Wheel Event
            canvas.addEventListener('wheel', (e) => {
                e.preventDefault();
                const delta = e.deltaY > 0 ? 0.1 : -0.1;
                currentZoom = Math.max(0.3, Math.min(1.5, currentZoom + delta)); // Clamp zoom
                camera.position.z = 3.5 * currentZoom;
                camera.position.y = 2.5 * currentZoom;
            }, { passive: false });

            // Listeners
            window.addEventListener('resize', onWindowResize);

            // Mouse/Touch Interaction
            canvas.addEventListener('mousedown', onMouseDown);
            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mouseup', onMouseUp);
            canvas.addEventListener('touchstart', onTouchStart, { passive: false });
            document.addEventListener('touchmove', onTouchMove, { passive: false });
            document.addEventListener('touchend', onTouchEnd);

            // Bind Rotation Buttons
            const btnLeft = document.getElementById('rotate-left');
            if (btnLeft) btnLeft.onclick = rotateLeft;
            const btnRight = document.getElementById('rotate-right');
            if (btnRight) btnRight.onclick = rotateRight;
            const btnAuto = document.getElementById('auto-rotate');
            if (btnAuto) btnAuto.onclick = toggleAuto;

            animate();
        }

        function animate() {
            requestAnimationFrame(animate);
            const time = Date.now() * 0.001;
            journeyTime += 0.05;
            effectTime += 0.05;

            // Rotation Logic
            if (isAutoRotate) targetRotation.y += 0.003;
            pillowGroup.rotation.y += (targetRotation.y - pillowGroup.rotation.y) * 0.1;
            pillowGroup.rotation.x += (targetRotation.x - pillowGroup.rotation.x) * 0.1;

            // X-RAY EFFECT: Transparency based on zoom
            if (pillow && schematicPlane) {
                // Calculate transparency: when zoomed in (currentZoom < 0.6), show schematic
                const xrayIntensity = Math.max(0, Math.min(1, (0.7 - currentZoom) / 0.4)); // 0-1 range

                // Fade out pillow material
                pillow.traverse((node) => {
                    if (node.isMesh && node.material) {
                        node.material.opacity = 1 - xrayIntensity * 0.7; // Min 0.3 opacity
                    }
                });

                // Fade in schematic plane
                schematicPlane.material.opacity = xrayIntensity;
            }

            // Base Float REMOVED for Idle Stability

            if (pillow) {
                if (activeEffect) {
                    // Active Features (Music, Alarm, etc)
                    if (activeEffect === 'music') {
                        const scale = 1 + Math.sin(effectTime * 3) * 0.015;
                        pillowGroup.scale.set(scale, scale, scale);
                    } else if (activeEffect === 'alarm') {
                        pillowGroup.position.x = (Math.random() - 0.5) * 0.015;
                        const pulse = (Math.sin(effectTime * 5) + 1) * 0.5;
                        pillow.traverse((node) => { if (node.isMesh && node.material && node.material.emissive) { node.material.emissive.setHex(0xffd700); node.material.emissiveIntensity = pulse * 0.4; } });
                    } else if (activeEffect === 'massage') {
                        // Kneading effect: scaling + slight rotation twist
                        const knead = Math.sin(effectTime * 4) * 0.02;
                        pillowGroup.scale.set(1 + knead, 1 - knead, 1 + knead);
                        pillowGroup.rotation.z = Math.sin(effectTime * 8) * 0.01;
                    }
                } else {
                    // Journey Logic
                    if (currentStage === 1) { // Stress
                        const jitter = Math.sin(journeyTime * 20) * 0.002;
                        pillowGroup.position.x = jitter;
                        pillowGroup.rotation.z = jitter * 2;
                        pillow.traverse((node) => { if (node.isMesh && node.material && node.material.emissive) { node.material.emissive.lerp(new THREE.Color(0xff3333), 0.1); node.material.emissiveIntensity = 0.2 + Math.sin(journeyTime * 10) * 0.1; } });
                    } else if (currentStage === 2) { // Insomnia
                        pillowGroup.rotation.z = Math.sin(journeyTime * 2) * 0.1;
                        pillow.traverse((node) => { if (node.isMesh && node.material && node.material.emissive) { node.material.emissive.lerp(new THREE.Color(0x112255), 0.1); node.material.emissiveIntensity = 0.3; } });
                    } else if (currentStage === 3) { // Solution
                        pillowGroup.rotation.z = Math.sin(journeyTime * 1.5) * 0.03;
                        // Removed vertical
                        pillow.traverse((node) => { if (node.isMesh && node.material && node.material.emissive) { node.material.emissive.lerp(new THREE.Color(0xffaa00), 0.1); node.material.emissiveIntensity = 0.3 + Math.sin(journeyTime * 3) * 0.1; } });
                    } else if (currentStage === 4) { // Relax
                        const targetScale = 1 + Math.sin(journeyTime * 2) * 0.02;
                        pillowGroup.scale.lerp(new THREE.Vector3(targetScale, targetScale, targetScale), 0.1);
                        pillow.traverse((node) => { if (node.isMesh && node.material && node.material.emissive) { node.material.emissive.lerp(new THREE.Color(0x44ffaa), 0.1); node.material.emissiveIntensity = 0.2; } });
                    } else if (currentStage === 5) { // Deep
                        pillowGroup.scale.lerp(new THREE.Vector3(1, 1, 1), 0.1);
                        pillow.traverse((node) => { if (node.isMesh && node.material && node.material.emissive) { node.material.emissive.lerp(new THREE.Color(0xaaccff), 0.05); node.material.emissiveIntensity = 0.4 + Math.sin(time) * 0.1; } });
                    } else {
                        // IDLE (Zero Force)
                        pillowGroup.position.y = 0; // Relative to container
                        pillowGroup.position.x = 0;
                        pillowGroup.rotation.z = 0;
                        pillowGroup.scale.lerp(new THREE.Vector3(1, 1, 1), 0.1);
                        pillow.traverse((node) => { if (node.isMesh && node.material && node.material.emissive) { node.material.emissive.lerp(new THREE.Color(0x000000), 0.1); node.material.emissiveIntensity = 0; } });
                    }
                }
            }
            renderer.render(scene, camera);
        }

        // ========== TEMPERATURE CONTROL ==========
        let currentTemperature = 30;

        window.setTemperature = function (value) {
            currentTemperature = parseInt(value);
            document.getElementById('temp-value').textContent = value + '¬∞C';

            // Visual: Apply red tint intensity based on temperature
            if (pillow) {
                const intensity = (currentTemperature - 30) / 40; // 0 to 0.5
                pillow.traverse((node) => {
                    if (node.isMesh && node.material && node.material.emissive) {
                        node.material.emissive.setHex(0xff4400); // Orange-red
                        node.material.emissiveIntensity = intensity;
                    }
                });
            }
            showOverlay("üå°Ô∏è Nhi·ªát: " + value + "¬∞C");
        }

        // ========== JOURNEY CAROUSEL ==========
        let carouselSlideIndex = 0;

        window.changeJourneySlide = function (direction) {
            const slides = document.querySelectorAll('.carousel-slide-lg');
            const dots = document.querySelectorAll('.dot-lg');

            if (slides.length === 0) return;

            slides[carouselSlideIndex].classList.remove('active');
            dots[carouselSlideIndex].classList.remove('active');

            carouselSlideIndex += direction;
            if (carouselSlideIndex >= slides.length) carouselSlideIndex = 0;
            if (carouselSlideIndex < 0) carouselSlideIndex = slides.length - 1;

            slides[carouselSlideIndex].classList.add('active');
            dots[carouselSlideIndex].classList.add('active');

            // Sync with 3D Model
            const step = parseInt(slides[carouselSlideIndex].dataset.step);
            setJourneyStep(step);
        }

        window.goToJourneySlide = function (step) {
            const slides = document.querySelectorAll('.carousel-slide-lg');
            const dots = document.querySelectorAll('.dot-lg');

            if (slides.length === 0) return;

            slides[carouselSlideIndex].classList.remove('active');
            dots[carouselSlideIndex].classList.remove('active');

            carouselSlideIndex = step - 1;

            slides[carouselSlideIndex].classList.add('active');
            dots[carouselSlideIndex].classList.add('active');

            // Sync with 3D Model
            setJourneyStep(step);
        }

        // ========== SCROLL ANIMATION ==========
        function handleScrollAnimation() {
            document.querySelectorAll('.scroll-animate').forEach(el => {
                if (el.getBoundingClientRect().top < window.innerHeight - 100) el.classList.add('visible');
            });
        }

        // ========== SMOOTH SCROLL & INIT ==========
        document.addEventListener('DOMContentLoaded', () => {
            createParticles();
            init3D();
            handleScrollAnimation();

            // Smooth Scroll
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    if (document.querySelector(this.getAttribute('href')))
                        document.querySelector(this.getAttribute('href')).scrollIntoView({ behavior: 'smooth' });
                });
            });
        });
        window.addEventListener('scroll', handleScrollAnimation);
    </script>
</body>

</html>